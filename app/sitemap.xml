from django.http import HttpResponse
from django.urls import reverse
from .models import Anime  # Anime modelini olamiz

def sitemap(request):
    urls = [
        {
            "loc": "https://anivibe.uz/",
            "priority": "1.0",
            "changefreq": "daily"
        },
        {
            "loc": "https://anivibe.uz/anime",
            "priority": "0.8",
            "changefreq": "daily"
        }
    ]

    # Har bir anime uchun link yaratamiz
    for anime in Anime.objects.all():
        urls.append({
            "loc": f"https://anivibe.uz/anime/{anime.slug}",
            "priority": "0.9",
            "changefreq": "daily"
        })

    xml = '<?xml version="1.0" encoding="UTF-8"?>\n'
    xml += '<urlset xmlns="http://www.sitemaps.org/schemas/sitemap/0.9">\n'
    for u in urls:
        xml += f"  <url>\n"
        xml += f"    <loc>{u['loc']}</loc>\n"
        if "priority" in u:
            xml += f"    <priority>{u['priority']}</priority>\n"
        if "changefreq" in u:
            xml += f"    <changefreq>{u['changefreq']}</changefreq>\n"
        xml += f"  </url>\n"
    xml += '</urlset>'

    return HttpResponse(xml, content_type="application/xml")
